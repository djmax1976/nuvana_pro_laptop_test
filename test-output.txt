
Running 64 tests using 8 workers

[1A[2K[1/64] [api] â€º tests\api\company-client-link.api.spec.ts:68:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-003: PUT /api/companies/:id - should reject request without auth token
[1A[2K[2/64] [api] â€º tests\api\company-client-link.api.spec.ts:85:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-004: GET /api/clients/dropdown - should reject request without auth token
[1A[2K[3/64] [api] â€º tests\api\company-client-link.api.spec.ts:56:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-002: GET /api/companies - should reject request without auth token
[1A[2K[4/64] [api] â€º tests\api\company-client-link.api.spec.ts:27:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-001: POST /api/companies - should reject request without auth token
[1A[2K[5/64] [api] â€º tests\api\company-client-link.api.spec.ts:162:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-008: POST /api/companies - should reject SQL injection in name field
[1A[2K[6/64] [api] â€º tests\api\company-client-link.api.spec.ts:126:7 â€º 2.7-API: Security - Authorization Tests â€º [P0] 2.7-SEC-006: GET /api/companies - should reject user without ADMIN_SYSTEM_CONFIG permission
[1A[2K[7/64] [api] â€º tests\api\company-client-link.api.spec.ts:99:7 â€º 2.7-API: Security - Authorization Tests â€º [P0] 2.7-SEC-005: POST /api/companies - should reject user without ADMIN_SYSTEM_CONFIG permission
[1A[2K[8/64] [api] â€º tests\api\company-client-link.api.spec.ts:196:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-009: POST /api/companies - should reject XSS in name field
[1A[2K[9/64] [api] â€º tests\api\company-client-link.api.spec.ts:144:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-007: POST /api/companies - should reject SQL injection in client_id
[1A[2K[10/64] [api] â€º tests\api\company-client-link.api.spec.ts:230:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-010: POST /api/companies - should reject invalid UUID format for client_id
[1A[2K[11/64] [api] â€º tests\api\company-client-link.api.spec.ts:246:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-011: GET /api/companies - should handle invalid clientId filter format
[1A[2K[12/64] [api] â€º tests\api\company-client-link.api.spec.ts:272:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-001: POST /api/companies - should reject name exceeding 255 characters
[1A[2K[13/64] [api] â€º tests\api\company-client-link.api.spec.ts:304:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-002: POST /api/companies - should accept name with exactly 255 characters
[1A[2K[14/64] [api] â€º tests\api\company-client-link.api.spec.ts:368:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-004: POST /api/companies - should reject null client_id
[1A[2K[15/64] [api] â€º tests\api\company-client-link.api.spec.ts:338:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-003: POST /api/companies - should reject whitespace-only name
[1A[2K[16/64] [api] â€º tests\api\company-client-link.api.spec.ts:384:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-005: POST /api/companies - should reject invalid status value
[1A[2K[17/64] [api] â€º tests\api\company-client-link.api.spec.ts:411:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-006: POST /api/companies - should handle unicode characters in name
[1A[2K[18/64] [api] â€º tests\api\company-client-link.api.spec.ts:441:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-007: POST /api/companies - should reject deleted client_id
[1A[2K[19/64] [api] â€º tests\api\company-client-link.api.spec.ts:471:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-008: GET /api/companies - should handle pagination edge cases
[1A[2K[20/64] [api] â€º tests\api\company-client-link.api.spec.ts:482:7 â€º 2.7-API: Edge Cases - Input Boundaries â€º [P1] 2.7-EDGE-009: GET /api/companies - should cap limit at maximum 100
[1A[2K[21/64] [api] â€º tests\api\company-client-link.api.spec.ts:502:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-001: POST /api/companies - should create company with valid client_id
[1A[2K[22/64] [api] â€º tests\api\company-client-link.api.spec.ts:572:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-002: POST /api/companies - should handle missing client_id
[1A[2K[23/64] [api] â€º tests\api\company-client-link.api.spec.ts:608:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-003: POST /api/companies - should handle non-existent client_id
[1A[2K[24/64] [api] â€º tests\api\company-client-link.api.spec.ts:631:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-004: POST /api/companies - should handle empty string client_id
[1A[2K[25/64] [api] â€º tests\api\company-client-link.api.spec.ts:656:7 â€º 2.7-API: Company-Client Linking - List includes client info (AC #2) â€º [P1] 2.7-API-005: GET /api/companies - should return client_id and client_name
[1A[2K[26/64] [api] â€º tests\api\company-client-link.api.spec.ts:706:7 â€º 2.7-API: Company-Client Linking - List includes client info (AC #2) â€º [P1] 2.7-API-006: GET /api/companies - should return pagination metadata
[1A[2K[27/64] [api] â€º tests\api\company-client-link.api.spec.ts:795:7 â€º 2.7-API: Company-Client Linking - Filter by client (AC #3) â€º [P0] 2.7-API-008: GET /api/companies - without filter should return all companies
[1A[2K[28/64] [api] â€º tests\api\company-client-link.api.spec.ts:729:7 â€º 2.7-API: Company-Client Linking - Filter by client (AC #3) â€º [P0] 2.7-API-007: GET /api/companies?clientId=xxx - should filter by client_id
[1A[2K[29/64] [api] â€º tests\api\company-client-link.api.spec.ts:853:7 â€º 2.7-API: Company-Client Linking - RLS enforcement (AC #4) â€º [P0] 2.7-API-009: System Admin should see all companies across clients
[1A[2K[30/64] [api] â€º tests\api\company-client-link.api.spec.ts:909:7 â€º 2.7-API: Company-Client Linking - Audit logging (AC #5) â€º [P0] 2.7-API-010: PUT /api/companies/:id - should log client_id change in audit
[1A[2K[31/64] [api] â€º tests\api\company-client-link.api.spec.ts:978:7 â€º 2.7-API: Company-Client Linking - Audit logging (AC #5) â€º [P0] 2.7-API-011: POST /api/companies - should include client_id in audit new_values
[1A[2K[32/64] [api] â€º tests\api\company-client-link.api.spec.ts:1025:7 â€º 2.7-API: Company-Client Linking - Client Dropdown Endpoint (AC #1, #3) â€º [P1] 2.7-API-012: GET /api/clients/dropdown - should return minimal client data
[1A[2K[33/64] [api] â€º tests\api\company-client-link.api.spec.ts:1073:7 â€º 2.7-API: Company-Client Linking - Client Dropdown Endpoint (AC #1, #3) â€º [P1] 2.7-API-013: GET /api/clients/dropdown - should only return active clients
[1A[2K[34/64] [api] â€º tests\api\company-client-link.api.spec.ts:1112:7 â€º 2.7-API: Company-Client Linking - Client Dropdown Endpoint (AC #1, #3) â€º [P1] 2.7-API-014: GET /api/clients/dropdown - should not return deleted clients
[1A[2K[35/64] [api] â€º tests\api\company-client-link.api.spec.ts:1151:7 â€º 2.7-API: Company-Client Linking - Client Dropdown Endpoint (AC #1, #3) â€º [P0] 2.7-API-015: GET /api/clients/dropdown - should return public_id for frontend usage
[1A[2K[36/64] [api] â€º tests\api\company-management.api.spec.ts:18:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-001: POST /api/companies - should create company with valid data (AC #1)
[1A[2K[37/64] [api] â€º tests\api\company-management.api.spec.ts:70:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-002: POST /api/companies - should reject invalid data (AC #1)
[1A[2K[38/64] [api] â€º tests\api\company-management.api.spec.ts:124:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-004: GET /api/companies - should list all companies with pagination (AC #2)
[1A[2K[39/64] [api] â€º tests\api\company-management.api.spec.ts:93:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-003: GET /api/companies/:companyId - should retrieve company by ID (AC #2)
[1A[2K[40/64] [api] â€º tests\api\company-management.api.spec.ts:172:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-005: PUT /api/companies/:companyId - should update company (AC #3)
[1A[2K[41/64] [api] â€º tests\api\company-management.api.spec.ts:225:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-006: DELETE /api/companies/:companyId - should soft delete non-ACTIVE company (AC #4)
[1A[2K[42/64] [api] â€º tests\api\company-management.api.spec.ts:268:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] DELETE /api/companies/:companyId - should cascade soft delete to stores and user roles
[1A[2K[43/64] [api] â€º tests\api\company-management.api.spec.ts:351:7 â€º 2.1-API: Company Management API - Permission Enforcement â€º [P0] 2.1-API-007: should deny access to non-System Admin users (AC #1, #2, #3, #4)
[1A[2K[44/64] [api] â€º tests\api\company-management.api.spec.ts:385:7 â€º 2.1-API: Company Management API - Permission Enforcement â€º [P0] 2.1-API-008: should deny access without authentication (AC #1, #2, #3, #4)
[1A[2K[45/64] [api] â€º tests\api\company-management.api.spec.ts:407:7 â€º 2.1-API: Company Management API - Error Handling â€º [P1] 2.1-API-009: GET /api/companies/:companyId - should return 404 for non-existent company (AC #2)
[1A[2K[46/64] [api] â€º tests\api\company-management.api.spec.ts:422:7 â€º 2.1-API: Company Management API - Error Handling â€º [P1] 2.1-API-010: PUT /api/companies/:companyId - should return 404 for non-existent company (AC #3)
[1A[2K[47/64] [api] â€º tests\api\company-management.api.spec.ts:438:7 â€º 2.1-API: Company Management API - Error Handling â€º [P1] 2.1-API-011: DELETE /api/companies/:companyId - should return 404 for non-existent company (AC #4)
[1A[2K[48/64] [api] â€º tests\api\company-management.api.spec.ts:451:7 â€º 2.1-API: Company Management API - Error Handling â€º [P0] 2.1-API-012: DELETE /api/companies/:companyId - should prevent deletion of ACTIVE company
[1A[2K[49/64] [api] â€º tests\api\company-management.api.spec.ts:486:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-013: POST /api/companies - should reject whitespace-only company name
[1A[2K[50/64] [api] â€º tests\api\company-management.api.spec.ts:508:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-014: POST /api/companies - should reject empty company name
[1A[2K[51/64] [api] â€º tests\api\company-management.api.spec.ts:531:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-015: POST /api/companies - should accept company name with exactly 255 characters
[1A[2K[52/64] [api] â€º tests\api\company-management.api.spec.ts:554:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-016: POST /api/companies - should reject company name exceeding 255 characters
[1A[2K[53/64] [api] â€º tests\api\company-management.api.spec.ts:577:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-017: POST /api/companies - should reject invalid status
[1A[2K[54/64] [api] â€º tests\api\company-management.api.spec.ts:597:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-018: POST /api/companies - should allow PENDING status
[1A[2K[55/64] [api] â€º tests\api\company-management.api.spec.ts:619:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-019: PUT /api/companies/:companyId - should allow status transitions
[1A[2K[56/64] [api] â€º tests\api\company-management.api.spec.ts:648:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-019a: PUT /api/companies/:companyId - should prevent activating company when client is inactive
[1A[2K[57/64] [api] â€º tests\api\company-management.api.spec.ts:686:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-020: PUT /api/companies/:companyId - should reject whitespace-only name update
[1A[2K[58/64] [api] â€º tests\api\company-management.api.spec.ts:745:7 â€º 2.1-API: Company Management API - Audit Log Validation â€º [P0] 2.1-API-022: audit log should include username and roles
[1A[2K[59/64] [api] â€º tests\api\company-management.api.spec.ts:715:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-021: should allow duplicate company names
[1A[2K[60/64] [api] â€º tests\api\company-management.api.spec.ts:779:7 â€º 2.1-API: Company Management API - Audit Log Validation â€º [P0] 2.1-API-023: audit log should capture x-forwarded-for IP when behind proxy
[1A[2K[61/64] [api] â€º tests\api\company-management.api.spec.ts:822:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-024: should sanitize SQL injection attempts in company name
[1A[2K[62/64] [api] â€º tests\api\company-management.api.spec.ts:855:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-025: should reject XSS attempts in company name
[1A[2K[63/64] [api] â€º tests\api\company-management.api.spec.ts:881:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-026: should reject excessively long company names (buffer overflow protection)
[1A[2K[64/64] [api] â€º tests\api\company-management.api.spec.ts:906:7 â€º 2.1-API: Company Management API - Concurrent Operations â€º [P0] 2.1-API-027: should handle concurrent updates to same company
[1A[2K  1) [api] â€º tests\api\company-management.api.spec.ts:597:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-018: POST /api/companies - should allow PENDING status 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m201[39m
    Received: [31m400[39m

      612 |
      613 |     // THEN: Company is created with PENDING status
    > 614 |     expect(response.status()).toBe(201);
          |                               ^
      615 |     const body = await response.json();
      616 |     expect(body.status).toBe("PENDING");
      617 |   });
        at c:\bmad\tests\api\company-management.api.spec.ts:614:31

    attachment #1: trace (application/zip) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    test-results\artifacts\api-company-management.api-cc2a2-should-allow-PENDING-status-api\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\api-company-management.api-cc2a2-should-allow-PENDING-status-api\trace.zip

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


[1A[2K  1 failed
    [api] â€º tests\api\company-management.api.spec.ts:597:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-018: POST /api/companies - should allow PENDING status 
  63 passed (5.1s)
