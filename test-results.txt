
> nuvana-pro@0.1.0 test:api
> playwright test --project=api --grep \[P0\] --reporter=list


Running 237 tests using 8 workers

  ok   2 [api] â€º tests\api\backend-setup.api.spec.ts:158:7 â€º 1.2-API-005: Backend Setup - Server Configuration â€º [P0] 1.2-API-005-001: server should start on configured port (114ms)
  ok   3 [api] â€º tests\api\backend-setup.api.spec.ts:91:7 â€º 1.2-API-003: Backend Setup - Security Headers (Helmet) â€º [P0] 1.2-API-003-001: Response should include security headers (118ms)
  ok   1 [api] â€º tests\api\backend-setup.api.spec.ts:22:7 â€º 1.2-API-001: Backend Setup - Health Check â€º [P0] 1.2-API-001-001: GET /api/health should return 200 OK with status (118ms)
  ok   5 [api] â€º tests\api\client-email-password.api.spec.ts:166:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should reject password shorter than 8 characters (367ms)
  ok   7 [api] â€º tests\api\client-email-password.api.spec.ts:142:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should reject invalid email format (354ms)
  ok   4 [api] â€º tests\api\client-email-password.api.spec.ts:119:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should reject missing email (362ms)
  ok   6 [api] â€º tests\api\client-email-password.api.spec.ts:94:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should require password for client creation (356ms)
  ok   8 [api] â€º tests\api\client-email-password.api.spec.ts:31:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should create User + Client + UserRole link with CLIENT_OWNER role (574ms)
  ok  10 [api] â€º tests\api\client-email-password.api.spec.ts:223:7 â€º Client Unified Authentication - Update Operations â€º [P0] PUT /api/clients/:id - should update both User and Client email (554ms)
  ok  13 [api] â€º tests\api\client-email-password.api.spec.ts:360:7 â€º Client Unified Authentication - Update Operations â€º [P0] PUT /api/clients/:id - should reject short password on update (273ms)
  ok  12 [api] â€º tests\api\client-email-password.api.spec.ts:321:7 â€º Client Unified Authentication - Update Operations â€º [P0] PUT /api/clients/:id - should not update password when not provided (309ms)
  ok  15 [api] â€º tests\api\client-email-password.api.spec.ts:437:7 â€º Client Unified Authentication - Security â€º [P0] GET /api/clients - password hash should not be returned in API response (297ms)
  ok   9 [api] â€º tests\api\client-email-password.api.spec.ts:192:7 â€º Client Unified Authentication - Create Operations â€º [P0] POST /api/clients - should reject duplicate email (User table uniqueness) (649ms)
  ok  14 [api] â€º tests\api\client-email-password.api.spec.ts:392:7 â€º Client Unified Authentication - Security â€º [P0] POST /api/clients - password should be hashed using bcrypt in User table (403ms)
  ok  11 [api] â€º tests\api\client-email-password.api.spec.ts:269:7 â€º Client Unified Authentication - Update Operations â€º [P0] PUT /api/clients/:id - should update User password (hashed) (761ms)
  ok  20 [api] â€º tests\api\client-management.api.spec.ts:92:7 â€º Client Management API - CRUD Operations â€º [P0] POST /api/clients - should reject invalid status value (AC #1) (114ms)
  ok  19 [api] â€º tests\api\client-management.api.spec.ts:73:7 â€º Client Management API - CRUD Operations â€º [P0] POST /api/clients - should reject invalid data (missing name) (AC #1) (125ms)
  ok  16 [api] â€º tests\api\client-email-password.api.spec.ts:465:7 â€º Client Unified Authentication - Security â€º [P0] GET /api/clients (list) - password hash should not be returned in list (326ms)
  ok  18 [api] â€º tests\api\client-management.api.spec.ts:25:7 â€º Client Management API - CRUD Operations â€º [P0] POST /api/clients - should create client with valid data (AC #1) (299ms)
  ok  23 [api] â€º tests\api\client-management.api.spec.ts:237:7 â€º Client Management API - CRUD Operations â€º [P0] GET /api/clients/:clientId - should return 404 for non-existent client (AC #3) (163ms)
  ok  21 [api] â€º tests\api\client-management.api.spec.ts:111:7 â€º Client Management API - CRUD Operations â€º [P0] POST /api/clients - should reject non-admin users (AC #1) (318ms)
  ok  25 [api] â€º tests\api\client-management.api.spec.ts:213:7 â€º Client Management API - CRUD Operations â€º [P0] GET /api/clients/:clientId - should retrieve client by ID with company count (AC #3) (294ms)
  ok  22 [api] â€º tests\api\client-management.api.spec.ts:131:7 â€º Client Management API - CRUD Operations â€º [P0] GET /api/clients - should list all clients with pagination (AC #2) (418ms)
  ok  24 [api] â€º tests\api\client-management.api.spec.ts:255:7 â€º Client Management API - CRUD Operations â€º [P0] PUT /api/clients/:clientId - should update client (AC #3) (366ms)
  ok  17 [api] â€º tests\api\client-email-password.api.spec.ts:495:7 â€º Client Unified Authentication - Login Flow â€º [P0] POST /api/auth/login - client should be able to login with User credentials (689ms)
  ok  26 [api] â€º tests\api\client-management.api.spec.ts:303:7 â€º Client Management API - CRUD Operations â€º [P0] PUT /api/clients/:clientId - should log status change to INACTIVE (AC #4) (349ms)
  ok  27 [api] â€º tests\api\client-management.api.spec.ts:341:7 â€º Client Management API - CRUD Operations â€º [P0] DELETE /api/clients/:clientId - should soft delete client (AC #5) (354ms)
  ok  31 [api] â€º tests\api\client-management.api.spec.ts:881:7 â€º Client Management API - Security â€º [P0] GET /api/clients - should prevent SQL injection in search parameter (174ms)
  ok  28 [api] â€º tests\api\client-management.api.spec.ts:427:7 â€º Client Management API - Permission Enforcement â€º [P0] All endpoints should require System Admin role (418ms)
  ok  30 [api] â€º tests\api\client-management.api.spec.ts:861:7 â€º Client Management API - Security â€º [P0] POST /api/clients - should prevent SQL injection in name field (284ms)
  ok  32 [api] â€º tests\api\client-management.api.spec.ts:893:7 â€º Client Management API - Security â€º [P0] All endpoints should reject unauthenticated requests (245ms)
  ok  29 [api] â€º tests\api\client-management.api.spec.ts:464:7 â€º Client Management API - Business Logic â€º [P0] DELETE /api/clients/:clientId - should cascade soft delete to companies, stores, and user roles (AC #5) (411ms)
  ok  38 [api] â€º tests\api\client-management.api.spec.ts:1154:7 â€º Client Management API - Dual ID Format Support (GET) â€º [P0] GET /api/clients/:id - should prevent IDOR with non-existent public_id (138ms)
  ok  34 [api] â€º tests\api\client-management.api.spec.ts:993:7 â€º Client Management API - Public ID Support â€º [P0] POST /api/clients - should auto-generate valid public_id (342ms)
  ok  37 [api] â€º tests\api\client-management.api.spec.ts:1125:7 â€º Client Management API - Dual ID Format Support (GET) â€º [P0] GET /api/clients/:id - should reject invalid public_id format (216ms)
  ok  35 [api] â€º tests\api\client-management.api.spec.ts:1069:7 â€º Client Management API - Dual ID Format Support (GET) â€º [P0] GET /api/clients/:id - should accept UUID format (backward compatibility) (328ms)
  ok  33 [api] â€º tests\api\client-management.api.spec.ts:1026:7 â€º Client Management API - Public ID Support â€º [P0] POST /api/clients - should generate unique public_ids for multiple clients (377ms)
  ok  36 [api] â€º tests\api\client-management.api.spec.ts:1097:7 â€º Client Management API - Dual ID Format Support (GET) â€º [P0] GET /api/clients/:id - should accept public_id format (new standard) (377ms)
  ok  41 [api] â€º tests\api\client-management.api.spec.ts:1230:7 â€º Client Management API - Dual ID Format Support (PUT) â€º [P0] PUT /api/clients/:id - should prevent IDOR via invalid public_id (183ms)
  ok  40 [api] â€º tests\api\client-management.api.spec.ts:1202:7 â€º Client Management API - Dual ID Format Support (PUT) â€º [P0] PUT /api/clients/:id - should update via public_id (new standard) (409ms)
  ok  39 [api] â€º tests\api\client-management.api.spec.ts:1174:7 â€º Client Management API - Dual ID Format Support (PUT) â€º [P0] PUT /api/clients/:id - should update via UUID (backward compatibility) (420ms)
  ok  43 [api] â€º tests\api\client-management.api.spec.ts:1301:7 â€º Client Management API - Dual ID Format Support (DELETE) â€º [P0] DELETE /api/clients/:id - should prevent IDOR via fabricated public_id (195ms)
  ok  47 [api] â€º tests\api\client-public-id-security.api.spec.ts:20:7 â€º Public ID Security - IDOR Prevention â€º [P0] SEC-PID-001: Should prevent enumeration attacks via sequential IDs (145ms)
  ok  46 [api] â€º tests\api\client-public-id-security.api.spec.ts:65:7 â€º Public ID Security - IDOR Prevention â€º [P0] SEC-PID-002: Should prevent IDOR by rejecting fabricated public_ids (201ms)
  ok  42 [api] â€º tests\api\client-management.api.spec.ts:1247:7 â€º Client Management API - Dual ID Format Support (DELETE) â€º [P0] DELETE /api/clients/:id - should delete via UUID (backward compatibility) (400ms)
  ok  49 [api] â€º tests\api\client-public-id-security.api.spec.ts:109:7 â€º Public ID Security - Format Validation â€º [P0] SEC-PID-004: Should reject SQL injection attempts in public_id (197ms)
  ok  44 [api] â€º tests\api\client-management.api.spec.ts:1274:7 â€º Client Management API - Dual ID Format Support (DELETE) â€º [P0] DELETE /api/clients/:id - should delete via public_id (new standard) (419ms)
  ok  50 [api] â€º tests\api\client-public-id-security.api.spec.ts:139:7 â€º Public ID Security - Format Validation â€º [P0] SEC-PID-005: Should reject XSS attempts in public_id (199ms)
  ok  45 [api] â€º tests\api\client-management.api.spec.ts:1317:7 â€º Client Management API - Dropdown Public ID Support â€º [P0] GET /api/clients/dropdown - should return public_id for each client (408ms)
  ok  51 [api] â€º tests\api\client-public-id-security.api.spec.ts:163:7 â€º Public ID Security - Format Validation â€º [P0] SEC-PID-006: Should reject path traversal attempts (211ms)
  ok  48 [api] â€º tests\api\client-public-id-security.api.spec.ts:84:7 â€º Public ID Security - IDOR Prevention â€º [P0] SEC-PID-003: Should prevent brute force enumeration via consistent 404s (414ms)
  ok  56 [api] â€º tests\api\client-public-id-security.api.spec.ts:301:7 â€º Public ID Security - Update and Delete Operations â€º [P0] SEC-PID-011: Should prevent unauthorized update via fabricated public_id (212ms)
  ok  52 [api] â€º tests\api\client-public-id-security.api.spec.ts:185:7 â€º Public ID Security - Authorization Bypass Prevention â€º [P0] SEC-PID-007: Should enforce authorization even with valid public_id (350ms)
  ok  59 [api] â€º tests\api\company-client-link.api.spec.ts:56:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-002: GET /api/companies - should reject request without auth token (31ms)
  ok  58 [api] â€º tests\api\company-client-link.api.spec.ts:27:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-001: POST /api/companies - should reject request without auth token (158ms)
  ok  60 [api] â€º tests\api\company-client-link.api.spec.ts:68:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-003: PUT /api/companies/:id - should reject request without auth token (29ms)
  ok  55 [api] â€º tests\api\client-public-id-security.api.spec.ts:319:7 â€º Public ID Security - Update and Delete Operations â€º [P0] SEC-PID-012: Should prevent unauthorized delete via fabricated public_id (295ms)
  ok  63 [api] â€º tests\api\company-client-link.api.spec.ts:85:7 â€º 2.7-API: Security - Authentication Tests â€º [P0] 2.7-SEC-004: GET /api/clients/dropdown - should reject request without auth token (25ms)
  ok  53 [api] â€º tests\api\client-public-id-security.api.spec.ts:208:7 â€º Public ID Security - Authorization Bypass Prevention â€º [P0] SEC-PID-008: Should not leak existence of clients through different error codes (406ms)
  ok  54 [api] â€º tests\api\client-public-id-security.api.spec.ts:247:7 â€º Public ID Security - Collision Resistance â€º [P0] SEC-PID-009: Should never generate duplicate public_ids (558ms)
  ok  57 [api] â€º tests\api\client-public-id-security.api.spec.ts:333:7 â€º Public ID Security - Update and Delete Operations â€º [P0] SEC-PID-013: Should prevent update via public_id from unauthorized role (569ms)
  ok  64 [api] â€º tests\api\company-client-link.api.spec.ts:144:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-007: POST /api/companies - should reject SQL injection in client_id (297ms)
  ok  67 [api] â€º tests\api\company-client-link.api.spec.ts:230:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-010: POST /api/companies - should reject invalid UUID format for client_id (210ms)
  ok  62 [api] â€º tests\api\company-client-link.api.spec.ts:126:7 â€º 2.7-API: Security - Authorization Tests â€º [P0] 2.7-SEC-006: GET /api/companies - should reject user without ADMIN_SYSTEM_CONFIG permission (398ms)
  ok  61 [api] â€º tests\api\company-client-link.api.spec.ts:99:7 â€º 2.7-API: Security - Authorization Tests â€º [P0] 2.7-SEC-005: POST /api/companies - should reject user without ADMIN_SYSTEM_CONFIG permission (412ms)
  ok  66 [api] â€º tests\api\company-client-link.api.spec.ts:162:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-008: POST /api/companies - should reject SQL injection in name field (336ms)
  ok  65 [api] â€º tests\api\company-client-link.api.spec.ts:196:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-009: POST /api/companies - should reject XSS in name field (374ms)
  ok  68 [api] â€º tests\api\company-client-link.api.spec.ts:246:7 â€º 2.7-API: Security - Input Validation & Injection Prevention â€º [P0] 2.7-SEC-011: GET /api/companies - should handle invalid clientId filter format (131ms)
  ok  69 [api] â€º tests\api\company-client-link.api.spec.ts:572:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-002: POST /api/companies - should handle missing client_id (126ms)
  ok  71 [api] â€º tests\api\company-client-link.api.spec.ts:608:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-003: POST /api/companies - should handle non-existent client_id (121ms)
  ok  70 [api] â€º tests\api\company-client-link.api.spec.ts:502:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-001: POST /api/companies - should create company with valid client_id (190ms)
  ok  72 [api] â€º tests\api\company-client-link.api.spec.ts:631:7 â€º 2.7-API: Company-Client Linking - Create with client_id (AC #1) â€º [P0] 2.7-API-004: POST /api/companies - should handle empty string client_id (142ms)
  ok  73 [api] â€º tests\api\company-client-link.api.spec.ts:729:7 â€º 2.7-API: Company-Client Linking - Filter by client (AC #3) â€º [P0] 2.7-API-007: GET /api/companies?clientId=xxx - should filter by client_id (201ms)
  ok  74 [api] â€º tests\api\company-client-link.api.spec.ts:795:7 â€º 2.7-API: Company-Client Linking - Filter by client (AC #3) â€º [P0] 2.7-API-008: GET /api/companies - without filter should return all companies (217ms)
  ok  75 [api] â€º tests\api\company-client-link.api.spec.ts:853:7 â€º 2.7-API: Company-Client Linking - RLS enforcement (AC #4) â€º [P0] 2.7-API-009: System Admin should see all companies across clients (227ms)
  ok  77 [api] â€º tests\api\company-client-link.api.spec.ts:978:7 â€º 2.7-API: Company-Client Linking - Audit logging (AC #5) â€º [P0] 2.7-API-011: POST /api/companies - should include client_id in audit new_values (222ms)
  ok  78 [api] â€º tests\api\company-client-link.api.spec.ts:1151:7 â€º 2.7-API: Company-Client Linking - Client Dropdown Endpoint (AC #1, #3) â€º [P0] 2.7-API-015: GET /api/clients/dropdown - should return public_id for frontend usage (178ms)
  ok  76 [api] â€º tests\api\company-client-link.api.spec.ts:909:7 â€º 2.7-API: Company-Client Linking - Audit logging (AC #5) â€º [P0] 2.7-API-010: PUT /api/companies/:id - should log client_id change in audit (289ms)
  ok  79 [api] â€º tests\api\company-management.api.spec.ts:70:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-002: POST /api/companies - should reject invalid data (AC #1) (176ms)
  ok  80 [api] â€º tests\api\company-management.api.spec.ts:18:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-001: POST /api/companies - should create company with valid data (AC #1) (222ms)
  ok  87 [api] â€º tests\api\company-management.api.spec.ts:385:7 â€º 2.1-API: Company Management API - Permission Enforcement â€º [P0] 2.1-API-008: should deny access without authentication (AC #1, #2, #3, #4) (73ms)
  ok  81 [api] â€º tests\api\company-management.api.spec.ts:93:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-003: GET /api/companies/:companyId - should retrieve company by ID (AC #2) (193ms)
  ok  82 [api] â€º tests\api\company-management.api.spec.ts:124:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-004: GET /api/companies - should list all companies with pagination (AC #2) (242ms)
  ok  83 [api] â€º tests\api\company-management.api.spec.ts:172:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-005: PUT /api/companies/:companyId - should update company (AC #3) (266ms)
  ok  84 [api] â€º tests\api\company-management.api.spec.ts:225:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] 2.1-API-006: DELETE /api/companies/:companyId - should soft delete non-ACTIVE company (AC #4) (332ms)
  ok  90 [api] â€º tests\api\company-management.api.spec.ts:508:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-014: POST /api/companies - should reject empty company name (181ms)
  ok  88 [api] â€º tests\api\company-management.api.spec.ts:451:7 â€º 2.1-API: Company Management API - Error Handling â€º [P0] 2.1-API-012: DELETE /api/companies/:companyId - should prevent deletion of ACTIVE company (248ms)
  ok  89 [api] â€º tests\api\company-management.api.spec.ts:486:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-013: POST /api/companies - should reject whitespace-only company name (218ms)
  ok  86 [api] â€º tests\api\company-management.api.spec.ts:268:7 â€º 2.1-API: Company Management API - CRUD Operations â€º [P0] DELETE /api/companies/:companyId - should cascade soft delete to stores and user roles (332ms)
  ok  92 [api] â€º tests\api\company-management.api.spec.ts:554:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-016: POST /api/companies - should reject company name exceeding 255 characters (151ms)
  ok  93 [api] â€º tests\api\company-management.api.spec.ts:577:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-017: POST /api/companies - should reject invalid status (4.7s)
  ok  96 [api] â€º tests\api\company-management.api.spec.ts:648:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-020: PUT /api/companies/:companyId - should reject whitespace-only name update (4.7s)
  ok  95 [api] â€º tests\api\company-management.api.spec.ts:619:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-019: PUT /api/companies/:companyId - should allow status transitions (4.7s)
  ok  94 [api] â€º tests\api\company-management.api.spec.ts:597:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-018: POST /api/companies - should allow PENDING status (4.7s)
  ok  91 [api] â€º tests\api\company-management.api.spec.ts:531:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-015: POST /api/companies - should accept company name with exactly 255 characters (4.9s)
  ok  98 [api] â€º tests\api\company-management.api.spec.ts:707:7 â€º 2.1-API: Company Management API - Audit Log Validation â€º [P0] 2.1-API-022: audit log should include username and roles (4.7s)
  ok  97 [api] â€º tests\api\company-management.api.spec.ts:677:7 â€º 2.1-API: Company Management API - Validation Edge Cases â€º [P0] 2.1-API-021: should allow duplicate company names (4.8s)
  ok  85 [api] â€º tests\api\company-management.api.spec.ts:351:7 â€º 2.1-API: Company Management API - Permission Enforcement â€º [P0] 2.1-API-007: should deny access to non-System Admin users (AC #1, #2, #3, #4) (5.2s)
  ok 105 [api] â€º tests\api\database-setup\migrations.api.spec.ts:16:7 â€º 1.3-API-003: Database Setup - Migrations â€º [P0] 1.3-API-003-001: Migrations directory should exist (17ms)
  ok 104 [api] â€º tests\api\database-setup\prisma-config.api.spec.ts:16:7 â€º 1.3-API-001: Database Setup - Prisma Configuration â€º [P0] 1.3-API-001-001: Prisma Client should be generated and importable (55ms)
  ok  99 [api] â€º tests\api\company-management.api.spec.ts:741:7 â€º 2.1-API: Company Management API - Audit Log Validation â€º [P0] 2.1-API-023: audit log should capture x-forwarded-for IP when behind proxy (195ms)
  ok 102 [api] â€º tests\api\company-management.api.spec.ts:843:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-026: should reject excessively long company names (buffer overflow protection) (152ms)
  ok 106 [api] â€º tests\api\database-setup\prisma-config.api.spec.ts:26:7 â€º 1.3-API-001: Database Setup - Prisma Configuration â€º [P0] 1.3-API-001-002: Prisma Client should connect to database (30ms)
  ok 101 [api] â€º tests\api\company-management.api.spec.ts:817:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-025: should reject XSS attempts in company name (194ms)
  ok 107 [api] â€º tests\api\database-setup\prisma-config.api.spec.ts:36:7 â€º 1.3-API-001: Database Setup - Prisma Configuration â€º [P0] 1.3-API-001-003: Database schema should include User model (48ms)
  ok 100 [api] â€º tests\api\company-management.api.spec.ts:784:7 â€º 2.1-API: Company Management API - Security Tests â€º [P0] 2.1-API-024: should sanitize SQL injection attempts in company name (239ms)
  ok 108 [api] â€º tests\api\database-setup\prisma-config.api.spec.ts:46:7 â€º 1.3-API-001: Database Setup - Prisma Configuration â€º [P0] 1.3-API-001-004: Database schema should include Company model (45ms)
  ok 103 [api] â€º tests\api\company-management.api.spec.ts:868:7 â€º 2.1-API: Company Management API - Concurrent Operations â€º [P0] 2.1-API-027: should handle concurrent updates to same company (210ms)
  ok 109 [api] â€º tests\api\database-setup\prisma-config.api.spec.ts:56:7 â€º 1.3-API-001: Database Setup - Prisma Configuration â€º [P0] 1.3-API-001-005: Database schema should include Store model (44ms)
  ok 113 [api] â€º tests\api\infrastructure.api.spec.ts:10:7 â€º Infrastructure & Server Configuration [P0] â€º [P0] Backend health endpoint returns correct structure (26ms)
  ok 114 [api] â€º tests\api\infrastructure.api.spec.ts:4:7 â€º Infrastructure & Server Configuration [P0] â€º [P0] Backend server starts on port 3001 (29ms)
  ok 110 [api] â€º tests\api\database-setup\schema-validation.api.spec.ts:63:7 â€º 1.3-API-002: Database Setup - Schema Validation â€º [P0] 1.3-API-002-002: Company model should have required fields (74ms)
  ok 117 [api] â€º tests\api\infrastructure.api.spec.ts:74:7 â€º CORS Configuration [P0] â€º [P1] Backend allows required HTTP methods (20ms)
  ok 119 [api] â€º tests\api\infrastructure.api.spec.ts:93:7 â€º CORS Configuration [P0] â€º [P1] Backend allows required headers (19ms)
  ok 116 [api] â€º tests\api\infrastructure.api.spec.ts:37:7 â€º CORS Configuration [P0] â€º [P0] Backend handles preflight OPTIONS requests (53ms)
  ok 115 [api] â€º tests\api\infrastructure.api.spec.ts:23:7 â€º CORS Configuration [P0] â€º [P0] Backend allows requests from frontend origin (62ms)
  ok 111 [api] â€º tests\api\database-setup\schema-validation.api.spec.ts:26:7 â€º 1.3-API-002: Database Setup - Schema Validation â€º [P0] 1.3-API-002-001: User model should have required fields (74ms)
  ok 118 [api] â€º tests\api\infrastructure.api.spec.ts:61:7 â€º CORS Configuration [P0] â€º [P0] Backend allows credentials in CORS (45ms)
  ok 112 [api] â€º tests\api\database-setup\schema-validation.api.spec.ts:98:7 â€º 1.3-API-002: Database Setup - Schema Validation â€º [P0] 1.3-API-002-003: Store model should have required fields and foreign key (107ms)
  ok 123 [api] â€º tests\api\jwt-token-system.api.spec.ts:73:7 â€º 1.6-API-002: JWT Token Validation Middleware â€º [P0] 1.6-API-002-002: Protected route should return 401 for expired access token (23ms)
  ok 128 [api] â€º tests\api\jwt-token-system.api.spec.ts:404:7 â€º 1.6-API-003: Refresh Token Endpoint â€º [P0] 1.6-API-003-004: POST /api/auth/refresh should return 401 for missing refresh token cookie (20ms)
  ok 121 [api] â€º tests\api\jwt-token-system.api.spec.ts:99:7 â€º 1.6-API-002: JWT Token Validation Middleware â€º [P0] 1.6-API-002-003: Protected route should return 401 for invalid JWT token (61ms)
  ok 126 [api] â€º tests\api\jwt-token-system.api.spec.ts:122:7 â€º 1.6-API-002: JWT Token Validation Middleware â€º [P0] 1.6-API-002-004: Protected route should return 401 for missing access token cookie (42ms)
  ok 127 [api] â€º tests\api\jwt-token-system.api.spec.ts:378:7 â€º 1.6-API-003: Refresh Token Endpoint â€º [P0] 1.6-API-003-003: POST /api/auth/refresh should return 401 for invalid refresh token (38ms)
  ok 125 [api] â€º tests\api\jwt-token-system.api.spec.ts:349:7 â€º 1.6-API-003: Refresh Token Endpoint â€º [P0] 1.6-API-003-002: POST /api/auth/refresh should return 401 for expired refresh token (61ms)
  ok 132 [api] â€º tests\api\jwt-token-system.api.spec.ts:701:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-003: API request should not retry infinitely if refresh fails (24ms)
  ok 131 [api] â€º tests\api\jwt-token-system.api.spec.ts:658:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-002: API request should fail if both access and refresh tokens are expired (32ms)
  ok 134 [api] â€º tests\api\jwt-token-system.api.spec.ts:826:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-005: Session validation endpoint should reject expired tokens on app initialization (18ms)
  ok 122 [api] â€º tests\api\jwt-token-system.api.spec.ts:28:7 â€º 1.6-API-002: JWT Token Validation Middleware â€º [P0] 1.6-API-002-001: Protected route should accept valid JWT access token from cookie (212ms)
  ok 124 [api] â€º tests\api\jwt-token-system.api.spec.ts:139:7 â€º 1.6-API-002: JWT Token Validation Middleware â€º [P0] 1.6-API-002-005: Middleware should extract user_id, email, roles, and permissions from token (235ms)
  ok 136 [api] â€º tests\api\rbac-framework.api.spec.ts:18:7 â€º RBAC Framework - Permission Checking â€º [P0] should grant access when user has required permission (125ms)
  ok 135 [api] â€º tests\api\jwt-token-system.api.spec.ts:852:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-006: Session validation endpoint should succeed with valid token on app initialization (192ms)
  ok 138 [api] â€º tests\api\rbac-framework.api.spec.ts:61:7 â€º RBAC Framework - Permission Checking â€º [P0] should check SYSTEM scope permissions correctly (125ms)
  ok 137 [api] â€º tests\api\rbac-framework.api.spec.ts:29:7 â€º RBAC Framework - Permission Checking â€º [P0] should deny access with 403 when user lacks required permission (234ms)
  ok 140 [api] â€º tests\api\rbac-framework.api.spec.ts:94:7 â€º RBAC Framework - Permission Checking â€º [P0] should deny COMPANY scope access to different company (197ms)
  ok 139 [api] â€º tests\api\rbac-framework.api.spec.ts:74:7 â€º RBAC Framework - Permission Checking â€º [P0] should check COMPANY scope permissions correctly (220ms)
  ok 141 [api] â€º tests\api\rbac-framework.api.spec.ts:126:7 â€º RBAC Framework - Permission Checking â€º [P0] should check STORE scope permissions correctly (180ms)
  ok 142 [api] â€º tests\api\rbac-framework.api.spec.ts:146:7 â€º RBAC Framework - Permission Checking â€º [P0] should deny STORE scope access to different store (173ms)
  ok 144 [api] â€º tests\api\rbac-framework.api.spec.ts:223:7 â€º RBAC Framework - Permission Checking â€º [P0] should handle multiple roles with different scopes (169ms)
  ok 145 [api] â€º tests\api\rbac-framework.api.spec.ts:245:7 â€º RBAC Framework - Permission Middleware â€º [P0] should validate permission before route handler executes (157ms)
  ok 143 [api] â€º tests\api\rbac-framework.api.spec.ts:188:7 â€º RBAC Framework - Permission Checking â€º [P0] should inherit COMPANY permissions to STORE scope (194ms)
  ok 147 [api] â€º tests\api\rbac-framework.api.spec.ts:280:7 â€º RBAC Framework - Permission Middleware â€º [P0] should return 401 when access token is missing (22ms)
  ok 148 [api] â€º tests\api\rbac-framework.api.spec.ts:298:7 â€º RBAC Framework - Permission Middleware â€º [P0] should return 401 when access token is invalid (17ms)
  ok 146 [api] â€º tests\api\rbac-framework.api.spec.ts:268:7 â€º RBAC Framework - Permission Middleware â€º [P0] should allow authorized requests to proceed (114ms)
  ok 149 [api] â€º tests\api\rbac-framework.api.spec.ts:314:7 â€º RBAC Framework - Permission Middleware â€º [P0] should return 401 when access token is expired (20ms)
  ok 150 [api] â€º tests\api\redis-rabbitmq-configuration.api.spec.ts:20:7 â€º 1.4-API-001: Redis Connection Configuration â€º [P0] 1.4-API-001-001: Redis client should be initialized and connection verified (29ms)
  ok 152 [api] â€º tests\api\redis-rabbitmq-configuration.api.spec.ts:73:7 â€º 1.4-API-002: RabbitMQ Connection Configuration â€º [P0] 1.4-API-002-001: RabbitMQ connection should be established (28ms)
  ok 151 [api] â€º tests\api\redis-rabbitmq-configuration.api.spec.ts:38:7 â€º 1.4-API-001: Redis Connection Configuration â€º [P0] 1.4-API-001-002: Redis connection should support ping operation (28ms)
  ok 153 [api] â€º tests\api\redis-rabbitmq-configuration.api.spec.ts:91:7 â€º 1.4-API-002: RabbitMQ Connection Configuration â€º [P0] 1.4-API-002-002: RabbitMQ channels should be created successfully (20ms)
  ok 154 [api] â€º tests\api\redis-rabbitmq-configuration.api.spec.ts:126:7 â€º 1.4-API-003: Health Check Endpoint â€º [P0] 1.4-API-003-001: GET /api/health should verify both Redis and RabbitMQ services (22ms)
  ok 156 [api] â€º tests\api\rls-policies.api.spec.ts:211:7 â€º RLS Policies - Company-Level Isolation â€º 2.3-API-003: [P0] should return empty result set when querying other company's data (260ms)
  ok 155 [api] â€º tests\api\rls-policies.api.spec.ts:102:7 â€º RLS Policies - Company-Level Isolation â€º 2.3-API-001: [P0] should filter Company table by user's assigned company_id (278ms)
  ok 157 [api] â€º tests\api\rls-policies.api.spec.ts:147:7 â€º RLS Policies - Company-Level Isolation â€º 2.3-API-002: [P0] should filter Store table by user's assigned company_id (275ms)
  ok 158 [api] â€º tests\api\rls-policies.api.spec.ts:341:7 â€º RLS Policies - Store-Level Isolation â€º 2.3-API-007: [P0] should filter Shift table by user's assigned store_id (261ms)
  ok 159 [api] â€º tests\api\rls-policies.api.spec.ts:406:7 â€º RLS Policies - Store-Level Isolation â€º 2.3-API-008: [P0] should return empty result set when querying other store's data (207ms)
  ok 161 [api] â€º tests\api\rls-policies.api.spec.ts:563:7 â€º RLS Policies - Transaction Store-Level Isolation â€º 2.3-API-023: [P0] should return empty result set when querying other store's transactions (233ms)
  ok 160 [api] â€º tests\api\rls-policies.api.spec.ts:463:7 â€º RLS Policies - Transaction Store-Level Isolation â€º 2.3-API-022: [P0] should filter Transaction table by user's assigned store_id (247ms)
  ok 162 [api] â€º tests\api\rls-policies.api.spec.ts:632:7 â€º RLS Policies - Transaction Store-Level Isolation â€º 2.3-API-024: [P0] should allow System Admin to access all transactions (242ms)
  ok 163 [api] â€º tests\api\rls-policies.api.spec.ts:828:7 â€º RLS Policies - System Admin Bypass â€º 2.3-API-009: [P0] should allow System Admin to access all companies (133ms)
  ok 164 [api] â€º tests\api\rls-policies.api.spec.ts:860:7 â€º RLS Policies - System Admin Bypass â€º 2.3-API-010: [P0] should allow System Admin to access all stores (152ms)
  ok 166 [api] â€º tests\api\rls-policies.api.spec.ts:992:7 â€º RLS Policies - Prisma ORM Integration â€º 2.3-API-013: [P0] should enforce RLS policies on direct SQL queries (223ms)
  ok 165 [api] â€º tests\api\rls-policies.api.spec.ts:957:7 â€º RLS Policies - Prisma ORM Integration â€º 2.3-API-012: [P0] should enforce RLS policies on Prisma queries (229ms)
  ok 168 [api] â€º tests\api\rls-policies.api.spec.ts:1208:7 â€º RLS Policies - Security Tests â€º 2.3-API-019: [P0] should prevent unauthorized access without valid user context (86ms)
  ok 167 [api] â€º tests\api\rls-policies.api.spec.ts:1170:7 â€º RLS Policies - Security Tests â€º 2.3-API-018: [P0] should prevent SQL injection in RLS context user ID (233ms)
  ok 169 [api] â€º tests\api\rls-policies.api.spec.ts:1234:7 â€º RLS Policies - Security Tests â€º 2.3-API-020: [P0] should prevent access with invalid user ID format (110ms)
  ok 171 [api] â€º tests\api\rls-policies.api.spec.ts:1297:7 â€º RLS Policies - Security Tests â€º 2.3-API-026: [P0] should prevent boolean-based SQL injection in RLS context (204ms)
  ok 170 [api] â€º tests\api\rls-policies.api.spec.ts:1263:7 â€º RLS Policies - Security Tests â€º 2.3-API-021: [P0] should prevent data leakage through error messages (234ms)
  ok 172 [api] â€º tests\api\rls-policies.api.spec.ts:1335:7 â€º RLS Policies - Security Tests â€º 2.3-API-027: [P0] should prevent UNION-based SQL injection in RLS context (186ms)
  ok 173 [api] â€º tests\api\rls-policies.api.spec.ts:1373:7 â€º RLS Policies - Security Tests â€º 2.3-API-028: [P0] should prevent comment-based SQL injection in RLS context (183ms)
Redis: Connecting...
Redis: Connecting...
Redis: Connecting...
Redis: Client ready
Redis: Client ready
Redis: Connected successfully
Redis: Connected successfully
Redis: Connecting...
Redis: Client ready
Redis: Connected successfully
Redis: Client ready
Redis: Connected successfully
[AuthService] Token expiry configuration: {
  defaultAccessTokenExpiry: [32m'1h'[39m,
  superAdminAccessTokenExpiry: [32m'8h'[39m,
  refreshTokenExpiry: [32m'7d'[39m
}
[AuthService] Token expiry configuration: {
  defaultAccessTokenExpiry: [32m'1h'[39m,
  superAdminAccessTokenExpiry: [32m'8h'[39m,
  refreshTokenExpiry: [32m'7d'[39m
}
[AuthService] Token expiry configuration: {
  defaultAccessTokenExpiry: [32m'1h'[39m,
  superAdminAccessTokenExpiry: [32m'8h'[39m,
  refreshTokenExpiry: [32m'7d'[39m
}
[AUDIT] Super admin token generated: {
  user_id: [32m'test-super-admin-id'[39m,
  email: [32m'superadmin@test.com'[39m,
  expiresIn: [32m'8h'[39m,
  timestamp: [32m'2025-11-22T16:17:31.583Z'[39m,
  client_id: [32m'N/A'[39m
}
[AUDIT] Super admin token generated: {
  user_id: [32m'test-multi-role-id'[39m,
  email: [32m'multirole@test.com'[39m,
  expiresIn: [32m'8h'[39m,
  timestamp: [32m'2025-11-22T16:17:31.582Z'[39m,
  client_id: [32m'N/A'[39m
}
  ok 120 [api] â€º tests\api\jwt-token-system.api.spec.ts:288:7 â€º 1.6-API-003: Refresh Token Endpoint â€º [P0] 1.6-API-003-001: POST /api/auth/refresh should generate new access and refresh tokens (2.9s)
  -  178 [api] â€º tests\api\store-management.api.spec.ts:54:7 â€º Store Management API - CRUD Operations â€º 2.2-API-001: [P0] POST /api/companies/:companyId/stores - should create store with valid data
  -  179 [api] â€º tests\api\store-management.api.spec.ts:104:7 â€º Store Management API - CRUD Operations â€º 2.2-API-002: [P0] POST /api/companies/:companyId/stores - should reject invalid data
  -  180 [api] â€º tests\api\store-management.api.spec.ts:124:7 â€º Store Management API - CRUD Operations â€º 2.2-API-003: [P0] POST /api/companies/:companyId/stores - should reject invalid timezone
  -  181 [api] â€º tests\api\store-management.api.spec.ts:144:7 â€º Store Management API - CRUD Operations â€º 2.2-API-005: [P0] POST /api/companies/:companyId/stores - should enforce company isolation
  -  182 [api] â€º tests\api\store-management.api.spec.ts:169:7 â€º Store Management API - CRUD Operations â€º 2.2-API-006: [P0] GET /api/stores/:storeId - should retrieve store by ID
  -  183 [api] â€º tests\api\store-management.api.spec.ts:203:7 â€º Store Management API - CRUD Operations â€º 2.2-API-007: [P0] GET /api/stores/:storeId - should enforce company isolation
  -  184 [api] â€º tests\api\store-management.api.spec.ts:232:7 â€º Store Management API - CRUD Operations â€º 2.2-API-008: [P0] GET /api/companies/:companyId/stores - should list stores for company
  -  185 [api] â€º tests\api\store-management.api.spec.ts:275:7 â€º Store Management API - CRUD Operations â€º 2.2-API-009: [P0] PUT /api/stores/:storeId - should update store
  -  186 [api] â€º tests\api\store-management.api.spec.ts:319:7 â€º Store Management API - CRUD Operations â€º 2.2-API-010: [P0] PUT /api/stores/:storeId - should enforce company isolation
  -  187 [api] â€º tests\api\store-management.api.spec.ts:349:7 â€º Store Management API - CRUD Operations â€º 2.2-API-011: [P0] DELETE /api/stores/:storeId - should soft delete store
  -  188 [api] â€º tests\api\store-management.api.spec.ts:391:7 â€º Store Management API - CRUD Operations â€º [P0] DELETE /api/stores/:storeId - should cascade soft delete to user roles
  -  189 [api] â€º tests\api\store-management.api.spec.ts:453:7 â€º Store Management API - CRUD Operations â€º 2.2-API-012: [P0] DELETE /api/stores/:storeId - should enforce company isolation
  -  190 [api] â€º tests\api\store-management.api.spec.ts:486:7 â€º Store Management API - Permissions â€º 2.2-API-013: [P0] should reject operations without STORE_CREATE permission
  -  191 [api] â€º tests\api\store-management.api.spec.ts:502:7 â€º Store Management API - Permissions â€º 2.2-API-014: [P0] should reject operations without STORE_READ permission
  -  192 [api] â€º tests\api\store-management.api.spec.ts:533:7 â€º Store Management API - Audit Trail â€º 2.2-API-015: [P0] audit log should include user_id and action
  -  193 [api] â€º tests\api\store-management.api.spec.ts:562:7 â€º Store Management API - Audit Trail â€º 2.2-API-016: [P0] audit log should capture IP address and user agent
  -  194 [api] â€º tests\api\store-management.api.spec.ts:596:7 â€º Store Management API - Error Handling â€º 2.2-API-017: [P0] should return 404 for non-existent store
  -  195 [api] â€º tests\api\store-management.api.spec.ts:609:7 â€º Store Management API - Error Handling â€º 2.2-API-018: [P0] should return 400 for invalid location_json structure
  -  196 [api] â€º tests\api\store-management.api.spec.ts:633:7 â€º Store Management API - Security â€º 2.2-API-019: [P0] AUTH BYPASS - should reject access without JWT token
  -  197 [api] â€º tests\api\store-management.api.spec.ts:647:7 â€º Store Management API - Security â€º 2.2-API-020: [P0] RBAC BYPASS - Store Manager cannot access System Admin endpoints
  -  198 [api] â€º tests\api\store-management.api.spec.ts:879:7 â€º Store Configuration API â€º 2.5-API-001: [P0] PUT /api/stores/:storeId/configuration - should update store configuration with valid data
  -  199 [api] â€º tests\api\store-management.api.spec.ts:943:7 â€º Store Configuration API â€º 2.5-API-002: [P0] PUT /api/stores/:storeId/configuration - should validate timezone format
  -  200 [api] â€º tests\api\store-management.api.spec.ts:972:7 â€º Store Configuration API â€º 2.5-API-004: [P0] PUT /api/stores/:storeId/configuration - should validate operating hours format
  -  201 [api] â€º tests\api\store-management.api.spec.ts:1003:7 â€º Store Configuration API â€º 2.5-API-005: [P0] PUT /api/stores/:storeId/configuration - should enforce company isolation
  -  202 [api] â€º tests\api\store-management.api.spec.ts:1074:7 â€º Store Configuration API â€º 2.5-API-006: [P0] PUT /api/stores/:storeId/configuration - should return 404 for non-existent store
  -  203 [api] â€º tests\api\store-management.api.spec.ts:1098:7 â€º Store Configuration API â€º 2.5-API-007: [P0] PUT /api/stores/:storeId/configuration - should enforce US standard operating hours format
  -  204 [api] â€º tests\api\store-management.api.spec.ts:1423:7 â€º Store Configuration API â€º 2.5-API-018: [P0] SECURITY - should reject SQL injection in timezone field
  -  205 [api] â€º tests\api\store-management.api.spec.ts:1451:7 â€º Store Configuration API â€º 2.5-API-019: [P0] SECURITY - should reject SQL injection in address field
  -  206 [api] â€º tests\api\store-management.api.spec.ts:1480:7 â€º Store Configuration API â€º 2.5-API-020: [P0] SECURITY - should reject XSS in address field
  -  207 [api] â€º tests\api\store-management.api.spec.ts:1517:7 â€º Store Configuration API â€º 2.5-API-021: [P0] SECURITY - should reject path traversal in address field
  -  208 [api] â€º tests\api\store-management.api.spec.ts:1546:7 â€º Store Configuration API â€º 2.5-API-022: [P0] SECURITY - should reject JSON injection in configuration object
  -  209 [api] â€º tests\api\store-management.api.spec.ts:1581:7 â€º Store Configuration API â€º 2.5-API-023: [P0] SECURITY - should reject deeply nested objects causing DoS
  -  210 [api] â€º tests\api\store-management.api.spec.ts:1612:7 â€º Store Configuration API â€º 2.5-API-024: [P0] SECURITY - should reject extremely large payloads causing DoS
  -  211 [api] â€º tests\api\store-management.api.spec.ts:1642:7 â€º Store Configuration API â€º 2.5-API-025: [P0] SECURITY - should reject access without JWT token (configuration endpoint)
  -  212 [api] â€º tests\api\store-management.api.spec.ts:1676:7 â€º Store Configuration API â€º 2.5-API-026: [P0] SECURITY - should reject token tampering (modified JWT)
  -  213 [api] â€º tests\api\store-management.api.spec.ts:1705:7 â€º Store Configuration API â€º 2.5-API-028: [P0] SECURITY - should reject mass assignment (additional fields beyond allowed)
  -  214 [api] â€º tests\api\store-management.api.spec.ts:1742:7 â€º Store Configuration API â€º 2.5-API-027: [P0] SECURITY - should prevent data leakage (no sensitive data in response)
  ok 175 [api] â€º tests\api\role-based-token-expiry.api.spec.ts:68:7 â€º Role-Based Token Expiry â€º [P0] User with multiple roles including SUPER_ADMIN should receive 8 hour token (12ms)
  ok 174 [api] â€º tests\api\role-based-token-expiry.api.spec.ts:12:7 â€º Role-Based Token Expiry â€º [P0] Super admin should receive 8 hour access token (18ms)
  ok 176 [api] â€º tests\api\role-based-token-expiry.api.spec.ts:40:7 â€º Role-Based Token Expiry â€º [P0] Regular user should receive 1 hour access token (17ms)
  ok 129 [api] â€º tests\api\jwt-token-system.api.spec.ts:420:7 â€º 1.6-API-003: Refresh Token Endpoint â€º [P0] 1.6-API-003-005: Refresh token should be rotated (old token invalidated, new token issued) (2.8s)
[AuthService] Token expiry configuration: {
  defaultAccessTokenExpiry: [32m'1h'[39m,
  superAdminAccessTokenExpiry: [32m'8h'[39m,
  refreshTokenExpiry: [32m'7d'[39m
}
  ok 130 [api] â€º tests\api\jwt-token-system.api.spec.ts:573:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-001: API request with expired access token should auto-refresh and retry successfully (2.9s)
  ok 177 [api] â€º tests\api\role-based-token-expiry.api.spec.ts:93:7 â€º Role-Based Token Expiry â€º [P0] User with no roles should receive 1 hour token (24ms)
  ok 133 [api] â€º tests\api\jwt-token-system.api.spec.ts:740:7 â€º 1.6-API-004: Automatic Token Refresh on 401 (Frontend Auto-Retry) â€º [P0] 1.6-API-004-004: Multiple API requests should reuse refreshed token (no duplicate refresh) (2.9s)
  ok 220 [api] â€º tests\api\transaction-import.api.spec.ts:103:7 â€º Transaction Import API - Authentication â€º 3.2-API-002: [P0] should return 401 when JWT token is invalid (26ms)
  ok 222 [api] â€º tests\api\transaction-import.api.spec.ts:79:7 â€º Transaction Import API - Authentication â€º 3.2-API-001: [P0] should return 401 when JWT token is missing (33ms)
  ok 216 [api] â€º tests\api\transaction-data-models.api.spec.ts:264:7 â€º Transaction Data Models - CRUD Operations â€º [P0] should enforce foreign key constraint - store must exist (201ms)
  ok 215 [api] â€º tests\api\transaction-data-models.api.spec.ts:209:7 â€º Transaction Data Models - CRUD Operations â€º [P0] should create TransactionPayments linked to Transaction (231ms)
  ok 217 [api] â€º tests\api\transaction-data-models.api.spec.ts:84:7 â€º Transaction Data Models - CRUD Operations â€º [P0] should create Transaction with all required fields (226ms)
  ok 219 [api] â€º tests\api\transaction-data-models.api.spec.ts:146:7 â€º Transaction Data Models - CRUD Operations â€º [P0] should create TransactionLineItems linked to Transaction (238ms)
  ok 218 [api] â€º tests\api\transaction-data-models.api.spec.ts:290:7 â€º Transaction Data Models - CRUD Operations â€º [P0] should cascade delete line items and payments when transaction is deleted (265ms)
  ok 221 [api] â€º tests\api\transaction-import.api.spec.ts:125:7 â€º Transaction Import API - Authentication â€º 3.2-API-003: [P0] should return 403 when user lacks TRANSACTION_CREATE permission (225ms)
  ok 223 [api] â€º tests\api\transaction-import.api.spec.ts:158:7 â€º Transaction Import API - Authentication â€º 3.2-API-004: [P0] should return 403 when store_id is not accessible to user (226ms)
  ok 224 [api] â€º tests\api\user-role-management.api.spec.ts:33:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-001: [P0] POST /api/admin/users - should create user with valid data (AC #2) (236ms)
  ok 225 [api] â€º tests\api\user-role-management.api.spec.ts:84:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-002: [P0] POST /api/admin/users - should reject invalid email format (AC #2) (131ms)
  ok 227 [api] â€º tests\api\user-role-management.api.spec.ts:122:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-004: [P0] POST /api/admin/users - should reject missing name (AC #2) (146ms)
  ok 229 [api] â€º tests\api\user-role-management.api.spec.ts:273:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-009: [P0] GET /api/admin/users/:userId - should get user details with roles (AC #1) (148ms)
  ok 233 [api] â€º tests\api\user-role-management.api.spec.ts:925:7 â€º 2.8-API: User Management API - Permission Enforcement â€º 2.8-API-025: [P0] All endpoints should reject unauthenticated requests (AC #8) (78ms)
  ok 226 [api] â€º tests\api\user-role-management.api.spec.ts:139:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-005: [P0] POST /api/admin/users - should create user with initial roles (AC #2) (219ms)
  ok 228 [api] â€º tests\api\user-role-management.api.spec.ts:177:7 â€º 2.8-API: User Management API - User CRUD Operations â€º 2.8-API-006: [P0] GET /api/admin/users - should list all users with pagination (AC #1) (215ms)
  ok 230 [api] â€º tests\api\user-role-management.api.spec.ts:408:7 â€º 2.8-API: User Management API - Role Assignment Operations â€º 2.8-API-014: [P0] POST /api/admin/users/:userId/roles - should assign SYSTEM scope role (AC #5) (207ms)
  ok 234 [api] â€º tests\api\user-role-management.api.spec.ts:1216:7 â€º 2.8-API: User Management API - Business Logic Rules â€º 2.8-API-042: [P0] POST /api/admin/users - should reject user creation without initial role (124ms)
  ok 232 [api] â€º tests\api\user-role-management.api.spec.ts:897:7 â€º 2.8-API: User Management API - Permission Enforcement â€º 2.8-API-024: [P0] POST /api/admin/users/:userId/roles - should reject non-admin users (AC #8) (218ms)
  ok 235 [api] â€º tests\api\user-role-management.api.spec.ts:1237:7 â€º 2.8-API: User Management API - Business Logic Rules â€º 2.8-API-043: [P0] POST /api/admin/users - should reject user creation with empty roles array (120ms)
  ok 231 [api] â€º tests\api\user-role-management.api.spec.ts:869:7 â€º 2.8-API: User Management API - Permission Enforcement â€º 2.8-API-023: [P0] All endpoints should require ADMIN_SYSTEM_CONFIG permission (AC #8) (246ms)
  ok 237 [api] â€º tests\api\user-role-management.api.spec.ts:1297:7 â€º 2.8-API: User Management API - Business Logic Rules â€º 2.8-API-045: [P0] PATCH /api/admin/users/:userId/status - should prevent self-deactivation (111ms)
  ok 236 [api] â€º tests\api\user-role-management.api.spec.ts:1256:7 â€º 2.8-API: User Management API - Business Logic Rules â€º 2.8-API-044: [P0] DELETE /api/admin/users/:userId/roles/:userRoleId - should prevent revoking last role (139ms)

  37 skipped
  200 passed (18.2s)
